#!/bin/bash

set -e

CHANGED_FILES=$(git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD)

echo "üîÑ Post-merge hook : v√©rification des changements..."

# V√©rifier si settings.json a chang√©
if echo "$CHANGED_FILES" | grep -q "settings.json"; then
    echo "‚ö†Ô∏è  settings.json a √©t√© mis √† jour"
    echo "   V√©rifiez et fusionnez avec settings.json.backup si n√©cessaire"
fi

# V√©rifier si les marketplaces ont chang√©
if echo "$CHANGED_FILES" | grep -q "plugins/"; then
    echo "üì¶ Mise √† jour des marketplaces..."
    claude plugin marketplace update 2>/dev/null || echo "‚ö†Ô∏è  √âchec mise √† jour marketplaces (continuez manuellement)"
fi

# V√©rifier si install.sh a chang√©
if echo "$CHANGED_FILES" | grep -q "install.sh"; then
    echo "üîß install.sh a √©t√© mis √† jour"
    echo "   Relancez-le si n√©cessaire : ~/.claude/install.sh"
fi

echo "‚úÖ Post-merge termin√©"
